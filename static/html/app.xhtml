<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Escape Room - Game Control</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="static/css/reset.css" type="text/css" />
    <link rel="stylesheet" href="static/css/style.css?r=1" type="text/css" />
    <script type="text/javascript" src="static/js/jquery.js"></script>
    <script type="text/javascript" src="static/js/app.js?r=5"></script>
    <!-- <audio id="text_alert_sound" src="static/audio/mixkit-horror-bell-cartoon-transition-598.wav" preload="auto"></audio> -->

    <script>
      //<![CDATA[
        var x = setInterval(function() {
          $.post('/event/is_game_finished', {}, function(data) {
            var res = JSON.parse(data);
            if (res["ok"]) {
              console.log('timer_chesk ok');
              if (res["status"] == "finished") {
                connection_state_message(res);
                $("#timer_start").addClass("disabled");
                $("#timer_stop").addClass("disabled");
              }
            }
          });
        }, 2000);

        $(document).on('click', '#set_timer', function(event) {
          var game_minutes = Number(window.prompt("Quanti minuti deve durare il gioco?", "60"));
          if(!game_minutes || game_minutes < 0) {
            window.alert('Errore: hai inserito un numero da 1 a 120?');
            return;
          }
          $.post('/event/set_timer', {"minutes": game_minutes}, function(data) {
            var res = JSON.parse(data);
            connection_state_message(res);
            if (res["ok"]) {
              $("#start_game").removeClass("disabled");
              $("#set_timer").addClass("disabled");
            } else {
              $("#start_game").addClass("disabled");
              $("#set_timer").removeClass("disabled");
            }
          });
        });
      //]]>
    </script>
  </head>
  
  <body>
    <div style="margin:50px 100px;">
      <div class="container">  <!-- ROW_1 -->
        <div class="item bordered">  <!-- COL_1 -->
          <div class="container title">
            <h2>Suoni e video</h2>
          </div>
          <div class="container room_ready" style="visibility:hidden;">
            <button>Suono di allerta</button>
            <button>Mostra video apertura</button>
            <button class="disabled">Video stanza completata</button>
          </div>
        </div>
        <div style="width: 10%;">  <!-- COL_2 -->
        </div>
        <div class="item bordered">  <!-- COL_3 -->
          <div class="container title">
            <h2>Gestione Tempo</h2>
          </div>
          <div class="container right room_ready" style="visibility:hidden;">
            <button id="set_timer">Imposta tempo</button>
            <button id="start_game" class="disabled">Avvia Partita</button>
          </div>
          <div class="container right room_ready" style="visibility:hidden;">
            <button id="timer_start" class="disabled">Play</button>
            <button id="timer_stop" class="disabled">Pausa</button>
          </div>
        </div>
      </div>
      <div class="container room_ready" style="visibility:hidden;">  <!-- ROW_2 -->
        <p>...</p>
      </div>
      <div class="container">  <!-- ROW_3 -->
        <div class="item bordered">  <!-- COL_1 -->
          <div class="container title">
            <h2>Invia messaggio alla stanza</h2>
          </div>
          <div class="container room_ready" style="visibility:hidden;">
            <input id="text_to_room" autocomplete="new-password" spellcheck="false"></input>
          </div>
          <div class="container right room_ready" style="visibility:hidden;">
            <button id="reset_text_to_room">Cancella</button>
            <button id="send_text_to_room">Invia</button>
          </div>
        </div>
      </div>
      <div class="container">  <!-- ROW_4 -->
        <div class="item bordered">  <!-- COL_1 -->
          <div class="container title">
            <h2>Connessione con la stanza</h2>
          </div>
          <div class="container">
            <span id="connection_state" class="ko_status">STANZA NON CONNESSA, AVVIARE NUOVA STANZA</span>
          </div>
          <div class="container right">
            <button id="room_connection">Avvia Stanza</button>
            <button id="test_room_connection">Test Manuale</button>
          </div>
        </div>
        <div style="width: 50%;">  <!-- COL_2 -->
        </div>
      </div>
    </div>
  </body>
</html>
